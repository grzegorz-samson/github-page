---
import PageLayout from '../../layouts/PageLayout.astro';
import ReleaseCard from '../../components/ReleaseCard.astro';
import DownloadGateModal from '../../components/DownloadGateModal.astro';
import { withBase } from '../../lib/paths';

const capabilityCards = [
  {
    icon: 'G',
    title: 'Granularny silnik wieloĹşrĂłdĹ‚owy',
    text: 'Ĺadowanie wielu plikĂłw WAV do wspĂłlnego bufora i budowanie zĹ‚oĹĽonych chmur ziaren w czasie rzeczywistym.',
    tags: ['Granular', 'WAV', 'Live']
  },
  {
    icon: 'P',
    title: 'Precyzyjna kontrola parametrĂłw',
    text: 'Sterowanie czasem trwania ziaren, gÄ™stoĹ›ciÄ… chmury, rozrzutem wysokoĹ›ci i gĹ‚oĹ›noĹ›ci oraz obwiedniÄ….',
    tags: ['Pitch', 'Gain', 'Envelope']
  },
  {
    icon: 'W',
    title: 'Workflow oparty o waveform',
    text: 'Selekcja, grupowanie i edycja zakresĂłw prĂłbkowania bezpoĹ›rednio na podglÄ…dzie fali.',
    tags: ['Waveform', 'Selection', 'Editing']
  },
  {
    icon: 'M',
    title: 'Rozszerzony routing kanaĹ‚Ăłw',
    text: 'Panel multichannel z routingiem, mute/solo oraz parami panorama dla zĹ‚oĹĽonych ukĹ‚adĂłw wyjĹ›ciowych.',
    tags: ['Routing', 'Multichannel', 'Pan']
  },
  {
    icon: 'A',
    title: 'Audio Generator (AI)',
    text: 'Panel konwersacyjny wspierajÄ…cy generowanie materiaĹ‚u audio i szybkie iteracje wariantĂłw brzmieniowych.',
    tags: ['Generator', 'Prompt', 'Session']
  }
];

const useCaseCards = [
  {
    icon: 'F',
    title: 'Tekstury filmowe i drony',
    text: 'Budowanie atmosfer i warstw tĹ‚a o ciÄ…gĹ‚ej, ewoluujÄ…cej strukturze.',
    tags: ['Cinematic', 'Ambient']
  },
  {
    icon: 'R',
    title: 'Rytmiczne glitche',
    text: 'Dekonstrukcja i ponowne skĹ‚adanie materiaĹ‚u perkusyjnego w nieregularne sekwencje.',
    tags: ['Glitch', 'Rhythm']
  },
  {
    icon: 'V',
    title: 'Resynteza gĹ‚osu i field recording',
    text: 'Przetwarzanie ĹşrĂłdeĹ‚ mowy i nagraĹ„ terenowych do form eksperymentalnych.',
    tags: ['Voice', 'Field Recording']
  },
  {
    icon: 'B',
    title: 'Praca badawczo-artystyczna',
    text: 'Eksploracja interaktywnych systemĂłw audio i multimodalnoĹ›ci w praktyce twĂłrczej.',
    tags: ['Research', 'Interactive']
  }
];

const guiItems = [
  {
    id: 'controls',
    chip: 'Controls',
    title: 'Controls Panel',
    shortDescription: 'GĹ‚Ăłwna warstwa kreacji i parametry granulacji.',
    imageSrc: withBase('/assets/plugin/controls-panel.png'),
    imageAlt: 'Panel Controls we wtyczce GranularVST-3',
    description:
      'GĹ‚Ăłwna warstwa kreacji: Duration, Pitch, Gain, Envelope i Cloud. To tutaj ustawiane sÄ… parametry odpowiadajÄ…ce za charakter i dynamikÄ™ chmury granularnej.',
    bullets: ['Sterowanie zakresem i dynamikÄ…', 'Szybki dostÄ™p do kluczowych parametrĂłw', 'Tryb pracy nastawiony na iteracje'],
    tags: ['Duration', 'Pitch', 'Cloud']
  },
  {
    id: 'multichannel',
    chip: 'Multichannel',
    title: 'Multichannel Panel',
    shortDescription: 'Routing kanaĹ‚Ăłw i panorama dla zĹ‚oĹĽonych ukĹ‚adĂłw.',
    imageSrc: withBase('/assets/plugin/multichannel-panel.png'),
    imageAlt: 'Panel Multichannel we wtyczce GranularVST-3',
    description:
      'Routing kanaĹ‚Ăłw z kontrolÄ… aktywnoĹ›ci, mute/solo i konfiguracjÄ… par panorama. Panel umoĹĽliwia pracÄ™ od stereo po rozszerzone ukĹ‚ady wielokanaĹ‚owe.',
    bullets: ['Kontrola kanaĹ‚Ăłw wyjĹ›ciowych', 'Parowanie L/R i panorama', 'SkalowalnoĹ›Ä‡ dla ukĹ‚adĂłw surround'],
    tags: ['Routing', 'Mute/Solo', 'Surround']
  },
  {
    id: 'audio-generator',
    chip: 'Audio Generator',
    title: 'Audio Generator (AI)',
    shortDescription: 'Generowanie materiaĹ‚u audio i iteracje promptowe.',
    imageSrc: withBase('/assets/plugin/audio-generator-panel.png'),
    imageAlt: 'Panel Audio Generator (AI) we wtyczce GranularVST-3',
    description:
      'Interfejs konwersacyjny do generowania materiaĹ‚u audio i zarzÄ…dzania sesjÄ…. Rozszerza workflow o komponent promptowy i szybkie iteracje wariantĂłw brzmieniowych.',
    bullets: ['Tworzenie wariantĂłw materiaĹ‚u audio', 'ObsĹ‚uga kontekstu sesji', 'Workflow promptowy dla sound designu'],
    tags: ['Generator', 'Prompt', 'Session']
  }
];

const initialPanel = guiItems[0];
---

<PageLayout
  lang="pl"
  title="Wtyczka VST | Projekt stypendialny"
  description="Opis wtyczki GranularVST-3: funkcjonalnoĹ›ci, panele i zastosowania."
>
  <section class="content-stack">
    <p class="section-kicker">Wtyczka VST</p>
    <h2>GranularVST-3</h2>
    <div class="text-panel">
      <p>
        GranularVST-3 to autorska wtyczka JUCE (VST3 + Standalone) do generatywnego przetwarzania krĂłtkich nagraĹ„
        i budowania wielowarstwowych struktur granularnych. NarzÄ™dzie wspiera pracÄ™ kompozytorskÄ…, sound design
        i eksperymentalne podejĹ›cie do kreacji dĹşwiÄ™ku.
      </p>
    </div>
    <ReleaseCard
      name="Generatywny syntezator granularny VST"
      version="v0.1.0-alpha"
      date="2026-02-21"
      pendingLabel="Pobieranie dostępne przez formularz poniżej"
      notes={[
        'Po zatwierdzeniu formularza zobaczysz aktywny link do pobrania.',
        'W odpowiedzi otrzymasz sumę kontrolną SHA256 do weryfikacji pliku.',
        'Zgoda na informacje o aktualizacjach jest wymagana, z możliwością rezygnacji.'
      ]}
      checksum={{ algo: 'SHA256', value: 'Udostępniane po wysłaniu formularza pobierania' }}
    />
    <div class="text-panel">
      <p>
        Aby pobrać wersję testową, wypełnij formularz pobierania. Dane są zapisywane w celu statystyki projektu i
        obsługi aktualizacji.
      </p>
      <DownloadGateModal lang="pl" pluginVersion="v0.1.0-alpha" contactEmail="kontakt@example.com" />
    </div>
  </section>

  <section class="content-stack">
    <p class="section-kicker">FunkcjonalnoĹ›ci</p>
    <h2>Co potrafi wtyczka</h2>
    <div class="plugin-feature-grid">
      {capabilityCards.map((item) => (
        <article class="plugin-feature-card">
          <div class="plugin-feature-card__head">
            <span class="plugin-feature-card__icon">{item.icon}</span>
            <h3>{item.title}</h3>
          </div>
          <p>{item.text}</p>
          <div class="plugin-tag-row">
            {item.tags.map((tag) => (
              <span class="plugin-tag">{tag}</span>
            ))}
          </div>
        </article>
      ))}
    </div>
  </section>

  <section class="content-stack">
    <p class="section-kicker">Use case</p>
    <h2>Zastosowania twĂłrcze</h2>
    <div class="plugin-feature-grid plugin-feature-grid--compact">
      {useCaseCards.map((item) => (
        <article class="plugin-feature-card">
          <div class="plugin-feature-card__head">
            <span class="plugin-feature-card__icon">{item.icon}</span>
            <h3>{item.title}</h3>
          </div>
          <p>{item.text}</p>
          <div class="plugin-tag-row">
            {item.tags.map((tag) => (
              <span class="plugin-tag">{tag}</span>
            ))}
          </div>
        </article>
      ))}
    </div>
  </section>

  <section class="content-stack">
    <p class="section-kicker">Panele interfejsu</p>
    <h2>Panele</h2>
    <div class="plugin-panels" data-plugin-panels data-initial-id={initialPanel.id}>
      <div class="plugin-panels-nav">
      {guiItems.map((item) => (
        <button type="button" class={`plugin-panel-tile ${item.id === initialPanel.id ? 'is-active' : ''}`} data-panel-id={item.id} aria-pressed={item.id === initialPanel.id ? 'true' : 'false'}>
          <img src={item.imageSrc} alt={item.imageAlt} loading="lazy" />
          <div class="plugin-panel-tile__body">
            <h3>{item.title}</h3>
            <p>{item.shortDescription}</p>
            <div class="plugin-tag-row">
              {item.tags.map((tag) => (
                <span class="plugin-tag">{tag}</span>
              ))}
            </div>
          </div>
        </button>
      ))}
      </div>

      <article class="plugin-panel-active" data-panel-active aria-live="polite">
        <div class="plugin-panel-active__media">
          <img src={initialPanel.imageSrc} alt={initialPanel.imageAlt} loading="lazy" data-active-image />
          <p class="plugin-panel-active__caption" data-active-caption>{initialPanel.shortDescription}</p>
        </div>
        <div class="plugin-panel-active__content">
          <p class="plugin-panel-active__kicker">Aktywny panel</p>
          <h3 data-active-title>{initialPanel.title}</h3>
          <p class="plugin-panel-active__description" data-active-description>{initialPanel.description}</p>
          <section class="plugin-panel-active__highlights">
            <h4>SzczegĂłĹ‚y panelu</h4>
            <ul data-active-bullets>
              {initialPanel.bullets.map((bullet) => (
                <li>{bullet}</li>
              ))}
            </ul>
          </section>
          <div class="plugin-tag-row plugin-panel-active__tags" data-active-tags>
            {initialPanel.tags.map((tag) => (
              <span class="plugin-tag">{tag}</span>
            ))}
          </div>
        </div>
      </article>
    </div>

    <div class="text-panel">
      <p>
        Kontekst naukowy i materiaĹ‚y konferencyjne sÄ… dostÄ™pne w zakĹ‚adce <a href={withBase('/pl/science/')}>Nauka</a>.
      </p>
    </div>
  </section>
</PageLayout>

<script define:vars={{ guiItems }}>
  const roots = document.querySelectorAll('[data-plugin-panels]');

  for (const root of roots) {
    const buttons = Array.from(root.querySelectorAll('button[data-panel-id]'));
    const activeCard = root.querySelector('[data-panel-active]');
    const image = root.querySelector('[data-active-image]');
    const caption = root.querySelector('[data-active-caption]');
    const title = root.querySelector('[data-active-title]');
    const description = root.querySelector('[data-active-description]');
    const bullets = root.querySelector('[data-active-bullets]');
    const tags = root.querySelector('[data-active-tags]');

    if (!buttons.length || !activeCard || !image || !caption || !title || !description || !bullets || !tags) continue;

    const itemMap = new Map(guiItems.map((item) => [item.id, item]));

    const setActive = (id, scrollToCard = true) => {
      const item = itemMap.get(id);
      if (!item) return;

      for (const button of buttons) {
        const isActive = button.dataset.panelId === id;
        button.classList.toggle('is-active', isActive);
        button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
      }

      image.setAttribute('src', item.imageSrc);
      image.setAttribute('alt', item.imageAlt);
      caption.textContent = item.shortDescription ?? item.description;
      title.textContent = item.title;
      description.textContent = item.description;

      bullets.textContent = '';
      for (const entry of item.bullets ?? []) {
        const li = document.createElement('li');
        li.textContent = entry;
        bullets.appendChild(li);
      }

      tags.textContent = '';
      for (const entry of item.tags ?? []) {
        const span = document.createElement('span');
        span.className = 'plugin-tag';
        span.textContent = entry;
        tags.appendChild(span);
      }

      if (scrollToCard) {
        activeCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    };

    for (const button of buttons) {
      button.addEventListener('click', () => {
        const id = button.dataset.panelId;
        if (id) setActive(id, true);
      });
    }

    const initialId = root.getAttribute('data-initial-id');
    if (initialId) setActive(initialId, false);
  }
</script>

